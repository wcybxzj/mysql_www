create table buy_log(user_id int unsigned  not null, buy_date DATE)engine=innodb;

insert into  buy_log values(1, '2009-01-01');
insert into  buy_log values(2, '2009-01-01');
insert into  buy_log values(3, '2009-01-01');
insert into  buy_log values(1, '2009-02-01');
insert into  buy_log values(3, '2009-02-01');
insert into  buy_log values(1, '2009-03-01');
insert into  buy_log values(1, '2009-04-01');

alter table buy_log add key (user_id);
alter table buy_log add key (user_id, buy_date);

======================================================================================================

mysql> EXPLAIN SELECT * FROM `buy_log` WHERE `user_id` =2;
+----+-------------+---------+------+-------------------+---------+---------+-------+------+-------+
| id | select_type | table   | type | possible_keys     | key     | key_len | ref   | rows | Extra |
+----+-------------+---------+------+-------------------+---------+---------+-------+------+-------+
|  1 | SIMPLE      | buy_log | ref  | user_id,user_id_2 | user_id | 4       | const |    1 |       |
+----+-------------+---------+------+-------------------+---------+---------+-------+------+-------+

======================================================================================================
联合索引的一个很大的优点索引的第二个列已经是有序的了,所以不用进行额外的file sort

//联合索引:
mysql> explain select * from buy_log where user_id  =1 order by  buy_date desc limit 3;
+----+-------------+---------+------+-------------------+-----------+---------+-------+------+--------------------------+
| id | select_type | table   | type | possible_keys     | key       | key_len | ref   | rows | Extra                    |
+----+-------------+---------+------+-------------------+-----------+---------+-------+------+--------------------------+
|  1 | SIMPLE      | buy_log | ref  | user_id,user_id_2 | user_id_2 | 4       | const |    4 | Using where; Using index |
+----+-------------+---------+------+-------------------+-----------+---------+-------+------+--------------------------+

//强制使用普通索引:
mysql> explain select * from buy_log force index(user_id) where user_id  =1 order by  buy_date desc limit 3;
+----+-------------+---------+------+---------------+---------+---------+-------+------+-----------------------------+
| id | select_type | table   | type | possible_keys | key     | key_len | ref   | rows | Extra                       |
+----+-------------+---------+------+---------------+---------+---------+-------+------+-----------------------------+
|  1 | SIMPLE      | buy_log | ref  | user_id       | user_id | 4       | const |    4 | Using where; Using filesort |
+----+-------------+---------+------+---------------+---------+---------+-------+------+-----------------------------+






======================================================================================================

======================================================================================================

======================================================================================================
